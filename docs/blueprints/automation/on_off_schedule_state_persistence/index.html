<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.72">
<link rel="alternate" type="application/rss+xml" href="/awesome-ha-blueprints/blog/rss.xml" title="Awesome HA Blueprints Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/awesome-ha-blueprints/blog/atom.xml" title="Awesome HA Blueprints Blog Atom Feed"><title data-react-helmet="true">On-Off schedule with state persistence | Awesome HA Blueprints</title><meta data-react-helmet="true" property="og:url" content="https://epmatt.github.io/awesome-ha-blueprints/docs/blueprints/automation/on_off_schedule_state_persistence"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="On-Off schedule with state persistence | Awesome HA Blueprints"><meta data-react-helmet="true" name="description" content="A simple on-off schedule, with the addition of state persistence across disruptive events, making sure the target device is always in the expected state."><meta data-react-helmet="true" property="og:description" content="A simple on-off schedule, with the addition of state persistence across disruptive events, making sure the target device is always in the expected state."><link data-react-helmet="true" rel="shortcut icon" href="/awesome-ha-blueprints/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://epmatt.github.io/awesome-ha-blueprints/docs/blueprints/automation/on_off_schedule_state_persistence"><link data-react-helmet="true" rel="alternate" href="https://epmatt.github.io/awesome-ha-blueprints/docs/blueprints/automation/on_off_schedule_state_persistence" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://epmatt.github.io/awesome-ha-blueprints/docs/blueprints/automation/on_off_schedule_state_persistence" hreflang="x-default"><link rel="stylesheet" href="/awesome-ha-blueprints/assets/css/styles.3ee1495d.css">
<link rel="preload" href="/awesome-ha-blueprints/assets/js/styles.e9da4329.js" as="script">
<link rel="preload" href="/awesome-ha-blueprints/assets/js/runtime~main.a22f04f2.js" as="script">
<link rel="preload" href="/awesome-ha-blueprints/assets/js/main.36275f6b.js" as="script">
<link rel="preload" href="/awesome-ha-blueprints/assets/js/2.b6324347.js" as="script">
<link rel="preload" href="/awesome-ha-blueprints/assets/js/3.75af688a.js" as="script">
<link rel="preload" href="/awesome-ha-blueprints/assets/js/26.fbf7c412.js" as="script">
<link rel="preload" href="/awesome-ha-blueprints/assets/js/28.8604d33e.js" as="script">
<link rel="preload" href="/awesome-ha-blueprints/assets/js/935f2afb.5695d7af.js" as="script">
<link rel="preload" href="/awesome-ha-blueprints/assets/js/17896441.54843776.js" as="script">
<link rel="preload" href="/awesome-ha-blueprints/assets/js/0.bd055293.js" as="script">
<link rel="preload" href="/awesome-ha-blueprints/assets/js/0b9d7b1f.6916bf4f.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#main" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top navbar--primary"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle" type="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/awesome-ha-blueprints/"><img src="/awesome-ha-blueprints/img/logo.svg" alt="Awesome HA Blueprints Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/awesome-ha-blueprints/img/logo.svg" alt="Awesome HA Blueprints Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><strong class="navbar__title">Awesome HA Blueprints</strong></a><a class="navbar__item navbar__link" href="/awesome-ha-blueprints/docs/introduction/">Getting Started</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/awesome-ha-blueprints/docs/blueprints/">Blueprints</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/EPMatt/awesome-ha-blueprints" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_GrZ2"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_71bT">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">ðŸŒž</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/awesome-ha-blueprints/"><img src="/awesome-ha-blueprints/img/logo.svg" alt="Awesome HA Blueprints Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/awesome-ha-blueprints/img/logo.svg" alt="Awesome HA Blueprints Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><strong class="navbar__title">Awesome HA Blueprints</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/awesome-ha-blueprints/docs/introduction/">Getting Started</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/awesome-ha-blueprints/docs/blueprints/">Blueprints</a></li><li class="menu__list-item"><a href="https://github.com/EPMatt/awesome-ha-blueprints" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper main-docs-wrapper"><div class="docPage_31aa"><main class="docMainContainer_3ufF"><div class="container padding-vert--lg docItemWrapper_3FMP"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><header><h1 class="docTitle_3a4h">On-Off schedule with state persistence</h1></header><div class="markdown"><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="description"></a>Description<a class="hash-link" href="#description" title="Direct link to heading">#</a></h2><p>This blueprint provides a simple on-off schedule, with the addition of state persistence across server reboots, powercuts, or other disruptive events which could potentially alter the expected state of the targeted entities. The automation makes sure the target is always in the expected state, even in these situations, but always leaving the freedom to manually toggle the target state as desired. It can be used on critical targets which require a simple on-off schedule during every single day.</p><p>One common scenario where this could be useful is in the case of a server reboot or shutdown. For example, let&#x27;s assume you&#x27;ve an automation <em>A</em> set to turn on light <em>L</em> at 12:00. If for whatever reason Home Assistant goes offline at 11:59 and turns back on at 12:01, automation <em>A</em> scheduled for 12:00 is not executed, with the result of <em>L</em> not being in the state you&#x27;d expect to be, after 12:00.</p><p>Using this blueprint in the above example would have guaranteed the expected behaviour, with the automation <em>A</em> being run at Home Assistant startup, and setting the <em>L</em> state as described by the schedule.</p><p>Examples of disruptive scenarios could include server reboots, network outages or powercuts. Since every installation could be influenced by many different events and check for them in many different ways, the blueprints includes the flexibility to optionally supply a custom event type which the automation will listen to. When such event is fired, the automation is run.</p><p>The blueprint already implements the support for listening to Home Assistant startup events, but this functionality can be disabled as desired by the user.</p><p>Internally, the blueprint calculates time ranges based on the provided On-Off times, bound to the target expected state. Whenever one of the specified times is reached or a disruptive event occurs, the automation retrieves the expected state from the calculated ranges, and enforces it on the target.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="requirements"></a>Requirements<a class="hash-link" href="#requirements" title="Direct link to heading">#</a></h2><p>No additional integrations or addons are required for this blueprint, since it&#x27;s only based on the <a href="https://www.home-assistant.io/integrations/homeassistant" target="_blank" rel="noopener noreferrer">Home Assistant Core Integration</a>.</p><p>If you optionally want to supply a custom event type to the blueprint, you should setup a mechanism to fire the event in any situation a state check should be performed. This could be an integration firing an event, or another automation, so any additional required setup is out of scope of this documentation.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="inputs"></a>Inputs<a class="hash-link" href="#inputs" title="Direct link to heading">#</a></h2><div><span style="font-weight:600">Automation Target <span class="badge badge--primary">Target</span> <span class="badge badge--warning"> Required</span></span><br><p style="font-size:0.9rem" class="margin-top--sm">The target which the automation will turn on and off based on the provided schedule. This include whatever can be specified as a target.</p><hr></div><div><span style="font-weight:600">On Time <span class="badge badge--primary">Time</span> <span class="badge badge--warning"> Required</span></span><br><p style="font-size:0.9rem" class="margin-top--sm">Time when the target should be placed in the on state.</p><hr></div><div><span style="font-weight:600">Off Time <span class="badge badge--primary">Time</span> <span class="badge badge--warning"> Required</span></span><br><p style="font-size:0.9rem" class="margin-top--sm">Time when the target should be placed in the off state.</p><hr></div><div><span style="font-weight:600">Custom Trigger Event <span class="badge badge--primary">Text</span> <span class="badge badge--info">Optional</span></span><br><p style="font-size:0.9rem" class="margin-top--sm">A custom event which can trigger the state check (eg. a powercut event reported by external integrations). If you do not want to provide a custom event, simply leave this input blank.</p><hr></div><div><span style="font-weight:600">Trigger at Home Assistant startup <span class="badge badge--primary">Boolean</span> <span class="badge badge--info">Optional</span></span><br><p style="font-size:0.9rem" class="margin-top--sm">Trigger the target state check and enforcement at Home Assistant startup. Disabled by default.</p><hr></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="additional-notes"></a>Additional Notes<a class="hash-link" href="#additional-notes" title="Direct link to heading">#</a></h2><p>This automation only provides a simple On-Off schedule. More complex situations could require a different approach to the problem. Also, be aware that running multiple automations generated with this blueprint against the same target could result in unexpected behaviour.</p></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/EPMatt/awesome-ha-blueprints/edit/main/docs/blueprints/automation/on_off_schedule_state_persistence.mdx" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" role="img" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-label="Edit page"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Docs pages navigation"><div class="pagination-nav__item"></div><div class="pagination-nav__item pagination-nav__item--next"></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#description" class="table-of-contents__link">Description</a></li><li><a href="#requirements" class="table-of-contents__link">Requirements</a></li><li><a href="#inputs" class="table-of-contents__link">Inputs</a></li><li><a href="#additional-notes" class="table-of-contents__link">Additional Notes</a></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container"><div class="footer__bottom text--center"><div class="footer__copyright">Awesome HA Blueprints is maintained by <a href="https://github.com/EPMatt">Matteo Agnoletto</a>.<br>Licensed under the <a href="https://github.com/EPMatt/awesome-ha-blueprints/blob/main/LICENSE">GPL-3.0 License</a></div></div></div></footer></div>
<script src="/awesome-ha-blueprints/assets/js/styles.e9da4329.js"></script>
<script src="/awesome-ha-blueprints/assets/js/runtime~main.a22f04f2.js"></script>
<script src="/awesome-ha-blueprints/assets/js/main.36275f6b.js"></script>
<script src="/awesome-ha-blueprints/assets/js/2.b6324347.js"></script>
<script src="/awesome-ha-blueprints/assets/js/3.75af688a.js"></script>
<script src="/awesome-ha-blueprints/assets/js/26.fbf7c412.js"></script>
<script src="/awesome-ha-blueprints/assets/js/28.8604d33e.js"></script>
<script src="/awesome-ha-blueprints/assets/js/935f2afb.5695d7af.js"></script>
<script src="/awesome-ha-blueprints/assets/js/17896441.54843776.js"></script>
<script src="/awesome-ha-blueprints/assets/js/0.bd055293.js"></script>
<script src="/awesome-ha-blueprints/assets/js/0b9d7b1f.6916bf4f.js"></script>
</body>
</html>